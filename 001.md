# kali linux渗透测试
## 001课程介绍

*本课程笔记讲长期连载*

*介绍本笔记是苑房弘老师的kali linux渗透测试学习笔记*

本课程有两部分组成

### 一部分是 kali linux中的工具使用

kali linux里面包含了大量的安全工具到目前为止官方统计有六百多种,能够熟练使用这些安全工具的话对一个渗透测试者的工作是有非常大的帮助作用的,能够非常好的辅助我们去完成日常的安全相关的工作



*kali(印度宗教中一个黑暗恐怖的角色)*


### 一部分是渗透测试方法论

作为渗透测试者安全从业者可能需要遵守这样一个方法论去进行自己的
渗透测试工作这样可以使我们的工作更加的高效更加的标准可以与别人与其他的渗透测试者进行沟通交流交换，促进我们对渗透测试工作的这个理解以及完善,

*这里的我指的是苑房弘老师*

__在正式开始学习之前我想先跟大家分享一下我对安全问题的根源的一些个思考,那么我在安全行业里已经从业了,到目前为止大概十年左右的时间,我一直不停的在从业过程中去思考这样一个问题,就是安全问题的根源到底是什么,那么做了这么多年的安全工作我就在不断的思考什么是安全问题的根源.__ 

最初我认为, 分层思想可能是安全问题产生的一个非常大的原因. 分层思想大家都清楚网络有分层, 软件也会有各种分层方法.分层思想是一个伟大的思想, 他的好处是可以把一个大的复杂的问题, 
简化简化成多个小的, 相对简单一点的问题, 也就是分层划分成不同的层面那么层与层之间, 我们通过标准, 制定出标准的接口，同一类型技术人员可以通过这个标准的接口去进行信息的交换，最后实现整个系统, 可以正常的工作, 那么这是分层思想的一个优点, 但是在这个分层的过程中我们每一个人其实都被分到了这一个大的系统里面的某一个层面里面, 这样大家看待整个系统都是片面的, 就好比盲人摸象一般. 

这个问题在从功能实现的角度上来讲并不是一个非常严重的问题, 每一个人只要做好自己本职方面的工作, 那么, 就可以实现整个系统的正常运作, 所以从功能实现的角度上来讲这不是一个, 重大的问题, 但是从安全的角度来讲这却是一个非常致命的问题, 因为安全从来没有片面和单一的安全, 任何一点的漏洞都可以造成整个系统的崩溃, 所以安全问题你必须从全面从从整体, 你要有能力从全面从整体去看待这个, 安全的问题, 这样你才能把安全的工作做好, 所以由于分层思想, 导致每一个计算机技术从业者, 他们对这个安全的认识都很片面所以就造成了这个安全问题根深蒂固久而久之很难去进行推进

 一方面我们技术从业人员把自己久而久之把自己固守着自己所在的一个层面上, 看待问题片面, 同时这些技术人员在搞技术的时候, 还习惯性了, 会只追求功能的实现, 可能是由于我们现在目前的系统越做越大越做越复杂

所以为了提高工作效率, 大家只会关心功能是否实现, 我们的这些技术人员他们很少能够, 从安全的角度去, 重新审视一下自己刚才做过的那些工作是不是也能达到相应的安全上的要求, 在实现了功能, 之后, 是不是能够达到, 相应的安全性

以时间久而久之呢我发现其实安全最大的最终的根源, 其实是人, 由于安全问题最终是人
人没有不犯错误的每个人都会犯错误, 所以这个安全问题其实, 说到底是没有办法彻底的从根本上把它解决掉除非你把人变成了, 一个完美的不会犯错误的人但是那样的人很显然是不存在的每个人都会犯错误, 包括我们安全从业者也可能会犯各种各样的错误, 所以既然安全问题的根源是人那么我们没有办法百分之百的解决安全的问题, 但是我们还是可以有一些方法可以降低这些个安全隐患给系统造成的威胁. 
传统以来, 这个安全建设都是以一种防护型的安全建设为主.

__什么叫防护型的安全建设?__

 也就是我们通常所说的我把不必要的服务全都搬掉不必要的端口全都封掉了, 把我的这个攻击面降低到最低, 从防护的角度先从防守的角度去建设我们的安全, 但是这样久而久之呢这这种防护型的安全呢 他的弊端就是防护的不够全面, 没有办法防防护到所有的方面, 可能是一个非常初级的黑客来对你的系统进行一些攻击的时候往往因为你一些小小的疏漏,  没有防护到的这个方面 他通过这些漏洞就可以攻击到你的系统封禁你的系统然后甚至控制你整个全部的系统 那么这个时候，久而久之你就发现这种防护型安全, 投入巨大, 周期很长, 然后无论是资金还是人员的投入都非常的巨大, 但最后取得的效果呢往往是非常的这个安全的成果是非常的脆弱

所以这个时候最近几年， 业界开始比较提倡以这种攻击性的安全来建设我们的系统

__什么是攻击型的安全?__

攻击型的安全也就是说我们要使用, 攻击的手段去探测我们这个系统, 搭建这个系统里头有哪些安全漏洞有哪些安全隐患, 我们需要以一种黑客的思维方式,  黑客的攻击手段,  去探索我们的系统去发现他的漏洞,  这样在系统正式上线,  对外提供服务之前, 把这些漏洞发现出来, 提前做好修复

渗透测试就是要尝试, 通过黑客攻击的这种, 思维方式以及攻击手段去挫败你的安全防御机制, 发现系统的安全弱点, 那么要, 渗透测试者造成攻击者的角度去思考问题, 去审视你这个系统, 去测量, 你现有的这些安全防护措施是不是真的有效是不是真的能够挡住, 黑客的攻击, 同时渗透测试者你要证明这些个问题的存在

你要可以让这些发现的漏洞可以付现, 让你的老板让你的同事, 让研发让运维让所有的部门的同事都是就了解到这个安全问题的存在, 同时你要证明这个问题他的危害性.

有的时候你在负责生产测试的时候会拿下一台服务器之后我们就认为这个初级渗透者就会触及的剩下的测试员他就会认为我的工作完成了因为我拿下了这台服务器, 但其实往往, 作为一个对自身的渗透工作人员来讲的话就是非常不够的, 因为你, 拿拿下来一台服务器这个时候你所证明的这个安全问题的危害性只有这一台服务器, 可能是一台服务器对如果说这个一台服务器, 
被你控制了对企业造成的影响其实是, 非常有限的, 那么, 做一个渗透测试者呢然后以这一台机器为基础去进一步向, 他的内网进行进一步的渗透, 去不断的证明, 不断的去放大你就发现了这个漏洞他会给企业造成什么样的危害, 这样才能够在企业的管理者心目中, 提升对安全的重视程度然后也同时证明您安全测试渗透测试, 他的价值所在. 

刚才一直讲我们要攻击型的
安全, 我们要渗透攻击

 那么对于一个系统做这么多的渗透测试攻击你从黑客的角度去思考问题用黑客的手段去测试系统. 

久而久之你就会变成一个, 跟那些个黑帽子黑客, 具有相同能力的白帽子黑客, 也就是说你完全可以成为一个黑帽的黑客, 这个时候你有能力去攻克一些系统, 你有能力拿到一些有价值的，可以获得灰色利益的那些信息资产


这个时候，安全测试者渗透测试者他往往就是坐在一个黑白边界的分界线上, 一脚踏错你可能有踏进了黑帽那边, 当然我们希望你保持白的这种, 如何把自己一直保持在摆在这边呢, 我们都知道现在中国包括中国在内这个信息安全关于信息安全犯罪方面的法律也得不断的完善所以法律对我们是有约束的, 那么我们不应该去不能去触犯法律触犯法律之后我们就可能会坐牢

 因为在这个计算机通信, 其实我们做的所有的操作,都是可以有据可查的只要一下足够的功夫去查，一定是可以查得到的, 所以一定不要去踏入到黑的那一边, 一定保持, 自己是站在白的这一边不要去拿自己不该拿的东西, 以免触犯法律给自己给家人带来麻烦


### PETS(http://www.pentest-standard.org)
现在开始介绍PETS
这是一个渗透测试标准他们把渗透测试分为了以下七个部分

1. 前期交互截断
2. 情报收集阶段
3. 威胁建模阶段
4. 漏洞分析阶段
5. 渗透攻击阶段
6. 后渗透测试阶段
7. 渗透测试报告


### 第一阶段前期交互阶段

我们做一个渗透测试的项目的时候, 首先要跟客户去进行前期的沟通, 这个阶段非常重要

首先最主要的一个目的你要确定你的渗透测试, 这个项目的范围, 如果不划清晰渗透测试范围的话有可能你的工作是永远都做不完的, 通常来说我们会怎么划动你这个什么特殊的范围呢？

会以一个应用系统, 如果这个系统太大我们会把这个系统切分成几个小的子系统对每个小的子系统来进行渗透测试, 我每一次做一个子系统的渗透测试, 那么我们这里所说的这个一个系统指的是一个应用系统, 比如说一个电商网站那么这是一个系统, 支撑这个系统的会有他的网络, 有他的交换机有可能防火墙有他的入侵检测有他的waf, 然后有他的服务器, 上面安装它的操作系统, 还有他的各种应用的平台数据库等等等等

 这些支撑起这一个应用的, 所有的设备系统软件组件放在一起成为一个系统,  通常来说渗透测试都会以这样一个系统作为一个渗透测试的目标来界定


同时渗透测试的前期交互阶段还需要对这个渗透测试的工作方式比如说你是现场测试还是远程测试, 你需不需要对目标系统做社工或ddos这样的攻击性的测试, 这些都需要在前期确定下来

通常来说根据我的经验来说通常的渗透测试项目, 是不会包含社会工程学和ddos, 这两种类型的这个渗透测试方式的

这就是第一个阶段就是关于渗透测试的前期交互的大概的内容, 当然这个阶段呢还要确定下来说我们需要投入多少人然后大概花多少的时间来完成这样一个项目, 等等关于项目的这个前期准备工作了都是在这个阶段来完成的.


### 第二阶段情报收集阶段 

前期交互之后, 我们就可以开始干活了渗透测试者就可以开始干活了, 渗透测试者首先要对目标系统进行各种的情报收集

#### 情报搜集有两个部分

__一部分是被动情报收集__
 
比如说,  邮箱地址, 联系人, 公司地址, dns信息, 服务器的ip域名, 以及通过搜索引擎进行一些这个近期的公司动态的收集, 同时呢也会
包含一些主动的我刚才说的那些都是比较被动性的信息收集, 也就是不和目标系统产生直接网络连接的这样的一些搜集方式.

__另外一部分就是主动的进行收集__

 也就是我要对这个目标系统进行主动的探测, 对他进行扫描, 进行主机的发现, 进行端口发现, 进行这些端口上的服务的发现, 等等这些信息的收集, 收集下来这个这些信息,用于下一个阶段叫做威胁建模.

### 第三阶段威胁建模

通过前期的信息收集我们对这个目标系统已经有一个轮廓性的认识, 通过这个轮廓性的认识之后我们通过威胁建模这个阶段,
 要把之前要这个分析之前的那些收集来的信息把它确定, 一条, 或者两条, 效率最高最快捷可以渗透进入这个系统的这个途径.

### 第四阶段漏洞分析阶段

威胁建模阶段攻击途径信息确定之后

接下来就是漏洞分析阶段
 比如说查看一下, 之前收集到的信息里面, 目标服务器使用的这个软件版本 是不是比较低是不是有已经公开的漏洞.

甚至有些软件的组件, 可能我们需要进行一些逆向工程的分析, 可能发现一些0day, 这个, 通过这些的漏洞, 可能在后续真正的渗透测试阶段, 会利用到去攻击进入系统, 然后在这个阶段也会如果你发这样的一些这漏洞的话, 需要编写一些的漏洞的攻击工具, 不见得所有的都有现成工具所有漏洞都有现成工具去给你使用.

这些阶段都结束后就要进行真正的渗透攻击阶段

### 第五阶段渗透攻击阶段

渗透攻击阶段, 有的人说这个我漏洞测试阶段都已经把漏洞分析的非常清楚了
渗透攻击就是无非把代码执行了一下然后就攻击进入系统了. 

其实, 真正的渗透攻击阶段吧往往并不是我们想象的那么的顺利, 因为会有很多的, , 安全防护机制可能是在我们前期的这个情报收集一些建模阶段那是没有发现的

所以往往你在测试和实验环境里头可以渗透成功的, 这些个漏洞还是在, 真实环境里往往就是不成功的

这个时候需要我们在重新进行进一步的情报收集威胁建模漏洞分析, 在不断不断的去找到渗透和攻击进去的这些个途径和路径, 渗透攻击阶段往往并不像想象中那么直接顺利

### 第六阶段后渗透测试阶段

如果已经成功拿下一台服务器的, 是否渗透测试已经完成呢?

其实并不是这样, 你要向你的客户, 去证明, 通过这一个小小的漏洞, 控制了这一台服务器 然后以这一台服务器你还可以进一步向内网进行, 做进一步的渗透, 然后可以取得更多的公司有价值的信息, 然后通过这个将你的渗透测试, 将你的渗透测试工作成果, 以及这个漏洞, 对你的客户对企业, 会造成哪些的影响, 威胁, 把它充分的展现出来.

后渗透测试阶段也是大部分白帽子可能比较欠缺的能力比较欠缺的一部分.

 大部分白帽子可能就是简单的比如说通过个外包然后身份注入一下或者跨站脚本执行了一下这样就漏洞就上报了, 但实际真正的黑客, 他们在控制了一台服务器之后还有大量的, 进一步的工作, 在后渗透测试阶段需要去做, 这里面其实最典型的例子就是这个美国的塔吉特公司事件

### 第七阶段渗透测试报告

这也是一个非常重要的阶段, 同时也是对渗透测试人员要去很高的一个阶段,后面会讲.



